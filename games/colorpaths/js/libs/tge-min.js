var TGE=TGE||{};TGE.Game=function(){this.mCanvasDiv=null;this.mReorientationDiv=null;this.mDirector=null;this.mScene=null;this.mCanvasPosition=null;this.mGameManager=new TGE.ObjectsManager();this.mLayers={};this.mBackground=null;this.mCameraLocation=null;this.mScalingFactor=1;this.mLoadingStartTime=new Date().getTime();this.mLoadingScreen=null;this.mImageAssetLists=new Array();this.mPlaying=false;this.mPaused=false;this.mCurrentLevel=null;this.mPauseButton=null;this.mUserPauseEnabled=false;this.mGameTime=0;this.mFilterStrength=10;this.mFrameTime=0;this.mLastLoop=new Date;this.mLastDisplay=new Date;this.mThisLoop;this.mFPSText=null;this.mMaxTickTime=0.1;this.mMinTickTime=Number.MIN_VALUE;this.mUIManager=new TGE.ObjectsManager();this.mScreenManager=new TGE.ScreenManager(this);this.mMouseX=0;this.mMouseY=0;this.mMouseDown=false;this.mKeysDown={};this.mDeviceInfo=new TGE.BrowserDetect();this.mDefaultLinkTarget="_blank";this.mButtonClickEvent="mousedown";CAAT.renderFrame=function(){for(var b=0,a=CAAT.director.length;b<a;b++){CAAT.director[b].renderFrame()}}};TGE.Game.prototype={IsPlatformAcceptable:function(){var d=false;if(this.mDeviceInfo.OSOrDevices.toLowerCase()=="iphone"||this.mDeviceInfo.OSOrDevices.toLowerCase()=="ipad"){var a=this.mDeviceInfo.OSversion.charCodeAt(0)-48;return a>=5}if(this.mDeviceInfo.OSOrDevices.toLowerCase()=="android"){return true}if(this.mDeviceInfo.OSOrDevices.toLowerCase()=="windows"||this.mDeviceInfo.OSOrDevices.toLowerCase()=="mac"){var c=this.mDeviceInfo.browser.toLowerCase();var b=parseFloat(this.mDeviceInfo.version);if(c=="firefox"){return b>=8}else{if(c=="explorer"){return b>=9}else{if(c=="chrome"){return b>=14}else{if(c=="safari"){return b>=5.1}else{}}}}}return true},DetermineCanvasPosition:function(){this.mCanvasPosition=getElementPosition(this.mCanvasDiv)},Launch:function(b,a){this.mCanvasDiv=document.getElementById(b);if(this.mCanvasDiv==null){console.log("***** ERROR: Could not find canvas div '"+b+"'");return false}this.ResizeViewportForDevice();this.mReorientationDiv=document.getElementById(a);this.DetermineCanvasPosition();window.addEventListener("resize",TGE.Game.prototype.DetermineCanvasPosition.bind(this),false);this.mCanvasDiv.addEventListener(this.mButtonClickEvent,TGE.Game.prototype.Click.bind(this),false);this.mCanvasDiv.addEventListener("mousedown",TGE.Game.prototype.MouseDown.bind(this),true);this.mCanvasDiv.addEventListener("mouseup",TGE.Game.prototype.MouseUp.bind(this),true);this.mCanvasDiv.addEventListener("mousemove",TGE.Game.prototype.MouseMove.bind(this),true);this.mCanvasDiv.addEventListener("keyup",TGE.Game.prototype.KeyDown.bind(this),true);this.mCanvasDiv.addEventListener("keydown",TGE.Game.prototype.KeyDown.bind(this),true);this.InitializeRenderer();this.mDeviceOrientation=new TGE.DeviceOrientation();this.mDeviceOrientation.RegisterOrientationChange(TGE.Game.prototype.OrientationChanged.bind(this));this.BeginLoad();return true},ResizeViewportForDevice:function(){viewport=document.querySelector("meta[name=viewport]");switch(this.mDeviceInfo.OSOrDevices){case"iPhone":if(this.mCanvasDiv.clientWidth==960||this.mCanvasDiv.clientWidth==640){viewport.setAttribute("content","width=device-width, maximum-scale=0.5, minimum-scale=0.5,initial-scale=0.5, user-scalable=no")}else{viewport.setAttribute("content","width=device-width, maximum-scale=1.0, minimum-scale=1.0,initial-scale=1.0, user-scalable=no")}break;case"Android":this.mDefaultLinkTarget="_self";break;case"iPad":if(parseInt(window.innerWidth)>1000){viewport.setAttribute("content","width=device-width; maximum-scale=2.0; minimum-scale=2.0,initial-scale=2.0,user-scalable=no")}else{viewport.setAttribute("content","width=device-width; maximum-scale=1.07; minimum-scale=1.07,initial-scale=1.07,user-scalable=no")}break;case"Windows":case"Mac":this.mButtonClickEvent="click";break;default:viewport.setAttribute("content","width=device-width, maximum-scale=1, minimum-scale=1, initial-scale=1,user-scalable=no");break}if(window.navigator.standalone==true){switch(this.mDeviceInfo.OSOrDevices){case"iPhone":viewport.setAttribute("content","width=device-width, height=device-height, maximum-scale=0.50, minimum-scale=0.50,initial-scale=0.50, user-scalable=no");break;case"iPad":viewport.setAttribute("content","width=device-width; maximum-scale=1.07; minimum-scale=1.07,initial-scale=1.07,user-scalable=no");break}}},InitializeRenderer:function(){var a=false;if(this.mCanvasDiv){if(this.mCanvasDiv instanceof HTMLDivElement){a=false}else{if(this.mCanvasDiv instanceof HTMLCanvasElement){a=true}else{this.mCanvasDiv=document.body}}}else{this.mCanvasDiv=document.createElement("div");document.body.appendChild(this.mCanvasDiv)}this.mDirector=new CAAT.Director().initialize(this.mCanvasDiv.clientWidth,this.mCanvasDiv.clientHeight,a?this.mCanvasDiv:undefined).setClear(false);if(!a){this.mCanvasDiv.appendChild(this.mDirector.canvas)}this.mDirector.setImagesCache(new Array());this.mScene=this.mDirector.createScene();this.mDirector.setScene(0)},OrientationChanged:function(a){if(this.mReorientationDiv==null){return}switch(a){case"portrait":this.mCanvasDiv.style.display="none";this.mReorientationDiv.style.display="block";this.PauseGame(true);break;case"landscape":this.mReorientationDiv.style.display="none";this.mCanvasDiv.style.display="block";break}},AssignImageAssetList:function(b,a){this.mImageAssetLists[b]={loaded:false,list:a}},LoadAssetList:function(b,d,c){var e=new TGE.AssetLoader();var a=this.mImageAssetLists[b];e.LoadAssetList(this,a,d,c)},BeginLoad:function(){this.LoadAssetList("loading",null,TGE.Game.prototype.LoadRequiredAssets.bind(this))},LoadRequiredAssets:function(){this.mScreenManager.Initialize(this);var a=null;if(typeof(LoadingScreen)!="undefined"){this.mLoadingScreen=this.ShowScreen(LoadingScreen);a=TGE.Game.prototype.loadRequiredAssetsCallback.bind(this)}this.Update();this.LoadAssetList("required",a,TGE.Game.prototype.finishedLoadingRequiredAssets.bind(this))},loadRequiredAssetsCallback:function(a){if(this.mLoadingScreen!=null&&typeof(this.mLoadingScreen.UpdateProgress)=="function"){this.mLoadingScreen.UpdateProgress(a)}},finishedLoadingRequiredAssets:function(){var a=Math.round((new Date().getTime()-this.mLoadingStartTime)/1000);this.AnalyticGameEvent("load",a);this.GotoMainMenu()},LoadLevelAssets:function(c,b,a){this.LoadAssetList("level_"+c.toString(),b,a)},StartLevel:function(a){var b=a==this.mCurrentLevel;this.mCurrentLevel=a;this.subclassSetupLevel(this.mCurrentLevel);this.AnalyticLevelEvent(b?"replay":"start");if(!this.mPlaying||this.mPaused){this.StartPlaying()}},FinishLevel:function(){this.AnalyticLevelEvent("complete");this.subclassFinishLevel()},Replay:function(){this.StartLevel(this.mCurrentLevel)},StartPlaying:function(){this.mGameTime=0;this.mPaused=false;this.mPlaying=true;this.subclassStartPlaying()},ClearScene:function(){this.mGameManager.Purge();this.mUIManager.Purge();this.mCameraLocation=$V([0,0]);this.mScene.emptyChildren();this.mFPSText=null;this.SetupLayers();this.mBackground=new CAAT.ActorContainer();this.mBackground.setBounds(0,0,this.mDirector.width,this.mDirector.height);this.mBackground.setFillStyle("#000");this.AddCAATActorToScene(this.mBackground);this.mScreenManager.Initialize(this);this.CreateLayer("FPS");var b=this.GetImage("pause_button");if(b!=null&&b.width>0){var a=Math.max(b.width,b.height);this.mPauseButton=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.Width()-a/2,a/2,"pause_button","ScreenManager");this.EnableUserPause()}},SetupLayers:function(){this.mLayers={};this.CreateLayer("TGE_default");this.subclassSetupLayers()},ShowScreen:function(a){return this.mScreenManager.ShowScreen(a)},GotoMainMenu:function(){this.mPaused=false;this.mPlaying=false;this.ClearScene();if(typeof(MainMenu)!="undefined"){this.ShowScreen(MainMenu)}else{this.StartPlaying()}},PauseGame:function(a){if(!this.mPlaying||a==this.mPaused){return}this.mPaused=a;this.AnalyticGameEvent(this.mPaused?"pause":"resume",this.mCurrentLevel);this.DetermineCanvasPosition();if(typeof(PauseScreen)!="undefined"){if(this.mPaused){this.ShowScreen(PauseScreen,false);this.DisableUserPause()}else{this.mScreenManager.CloseScreen(PauseScreen);this.EnableUserPause()}}},DisableUserPause:function(){this.mUserPauseEnabled=false;if(this.mPauseButton!=null){this.mPauseButton.Hide()}},EnableUserPause:function(){this.mUserPauseEnabled=true;if(this.mPauseButton!=null){this.mPauseButton.Show()}},Update:function(){var a=(this.mThisLoop=new Date)-this.mLastLoop;this.mFrameTime+=(a-this.mFrameTime)/this.mFilterStrength;this.mLastLoop=this.mThisLoop;this.updateFPSDisplay();a=a/1000;a=Math.max(this.mMinTickTime,a);a=Math.min(this.mMaxTickTime,a);if(!this.mPaused){this.mGameTime+=a}this.mScreenManager.Update(a);this.mUIManager.NotifyObjectsOfMouseOver(this.mMouseX,this.mMouseY);if(!this.mPaused){this.mGameManager.NotifyObjectsOfMouseOver(this.mMouseX,this.mMouseY);this.updateObjects(a)}if(this.mPlaying&&!this.mPaused){this.subclassUpdateGame(a)}this.updateObjectsToScreen();CAAT.renderFrame();requestAnimFrame(TGE.Game.prototype.Update.bind(this))},SetConstantTickTime:function(a){this.mMinTickTime=this.mMaxTickTime=a},SetBackgroundColor:function(a){this.mBackground.setFillStyle(a)},AddImage:function(a,b){this.mDirector.addImage(a,b,true)},CreateLayer:function(a){var b=new CAAT.ActorContainer();this.mLayers[a]=b;this.mScene.addChild(b)},CreateWorldEntity:function(b){var a=new b;b.prototype.constructor.apply(a,[this]);this.mGameManager.AddObject(a);return a},CreateUIEntity:function(b){var a=new b;b.prototype.constructor.apply(a,[this]);this.mUIManager.AddObject(a);return a},AddCAATActorToScene:function(c,a){a=typeof a!=="undefined"?a:"TGE_default";var b=this.mScene;if(a!=null&&a in this.mLayers){b=this.mLayers[a]}b.addChild(c)},RemoveCAATActorFromScene:function(c,a){a=typeof a!=="undefined"?a:"TGE_default";var b=this.mScene;if(a!=null&&a in this.mLayers){b=this.mLayers[a]}b.removeChild(c)},ShowFramerateDisplay:function(a,d,c,b){if(this.mFPSText!=null){this.mFPSText.MarkForRemoval()}this.mFPSText=this.CreateUIEntity(TGE.Text).Setup(a,d,"",c.toString()+"px Arial","center","middle",b,"FPS")},updateFPSDisplay:function(){var a=this.mThisLoop-this.mLastDisplay;if(a<1000){return}this.mLastDisplay=this.mThisLoop;if(this.mFrameTime>0&&this.mFPSText!=null){this.mFPSText.Show();this.mFPSText.SetText(Math.round(1000/this.mFrameTime).toFixed(0)+"fps")}},updateObjects:function(a){this.mGameManager.Update(a);this.mUIManager.Update(a)},updateObjectsToScreen:function(){this.mGameManager.UpdateObjectsToScreen();this.mUIManager.UpdateObjectsToScreen()},EndGame:function(){if(!this.mPlaying){return}this.mPlaying=false;this.DisableUserPause();this.subclassEndGame();if(typeof(GameOver)!="undefined"){this.ShowScreen(GameOver)}},CurrentLevel:function(){return this.mCurrentLevel},Click:function(a){this.mUIManager.NotifyObjectsOfClick(this.mMouseX*this.mScalingFactor,this.mMouseY*this.mScalingFactor)},MouseMove:function(a){this.mMouseX=(a.pageX-this.mCanvasPosition.x);this.mMouseY=(a.pageY-this.mCanvasPosition.y);if(!this.mPaused){this.subclassMouseMove()}},MouseDown:function(b){this.mMouseX=(b.pageX-this.mCanvasPosition.x);this.mMouseY=(b.pageY-this.mCanvasPosition.y);this.mMouseDown=true;if(this.mUserPauseEnabled&&this.mPauseButton!=null){var a=Math.max(this.mPauseButton.Width(),this.mPauseButton.Height());if(this.mMouseX>this.Width()-a&&this.mMouseY<a){this.PauseGame(true);return}}this.mUIManager.NotifyObjectsOfMouseDown(this.mMouseX*this.mScalingFactor,this.mMouseY*this.mScalingFactor);if(!this.mPaused){this.mGameManager.NotifyObjectsOfMouseDown(this.mMouseX*this.mScalingFactor,this.mMouseY*this.mScalingFactor);this.subclassMouseDown()}},MouseUp:function(a){this.mMouseX=(a.pageX-this.mCanvasPosition.x);this.mMouseY=(a.pageY-this.mCanvasPosition.y);this.mMouseDown=false;this.mUIManager.NotifyObjectsOfMouseUp(this.mMouseX*this.mScalingFactor,this.mMouseY*this.mScalingFactor);if(!this.mPaused){this.mGameManager.NotifyObjectsOfMouseUp(this.mMouseX*this.mScalingFactor,this.mMouseY*this.mScalingFactor);this.subclassMouseUp()}},MouseX:function(){return this.mMouseX},MouseY:function(){return this.mMouseY},IsMouseDown:function(){return this.mMouseDown},KeyDown:function(a){this.mKeysDown[a.keyCode]=true},KeyUp:function(a){this.mKeysDown[a.keyCode]=false},IsKeyDown:function(a){return this.mKeysDown[a]},Width:function(){return this.mDirector.width},Height:function(){return this.mDirector.height},GameTime:function(){return this.mGameTime},NumGameObjects:function(){return this.mGameManager.NumObjects()},NumUIObjects:function(){return this.mUIManager.NumObjects()},CameraLocation:function(){return this.mCameraLocation},ScreenX:function(a){return(this.mDirector.width/2)+(a-this.mCameraLocation.e(1))},ScreenY:function(a){return(this.mDirector.height/2)-(a-this.mCameraLocation.e(2))},GetImage:function(a){return this.mDirector.getImage(a)},OpenURL:function(a){this.AnalyticClickThruEvent(a);window.open(a,this.mDefaultLinkTarget)},PlayGame:function(){this.AnalyticGameEvent("begin");this.subclassPlayGame()},CurrentScore:function(){return 0},subclassSetupLayers:function(){},subclassPlayGame:function(){this.StartLevel(-1)},subclassSetupLevel:function(a){},subclassStartPlaying:function(){},subclassStartLevel:function(){},subclassFinishLevel:function(){},subclassUpdateGame:function(a){},subclassEndGame:function(a){},subclassMouseMove:function(){},subclassMouseDown:function(){},subclassMouseUp:function(){},AnalyticGameEvent:function(a,b){if(this.mAnalytics!=null){this.mAnalytics.LogGameEvent(a,this.mCurrentLevel,b)}},AnalyticShareEvent:function(a){if(this.mAnalytics!=null){this.mAnalytics.LogShareEvent(a,this.mCurrentLevel)}},AnalyticLevelEvent:function(a){if(this.mAnalytics!=null){this.mAnalytics.LogLevelEvent(a,this.mCurrentLevel,this.mGameTime)}},AnalyticAchievementEvent:function(b,a){if(this.mAnalytics!=null){this.mAnalytics.LogAchievementEvent(b,this.mCurrentLevel,a)}},AnalyticClickThruEvent:function(a){if(this.mAnalytics!=null){this.mAnalytics.LogClickThruEvent(a,this.mCurrentLevel)}},AnalyticCustomEvent:function(a,c,b){if(this.mAnalytics!=null){this.mAnalytics.LogCustomEvent(a,this.mCurrentLevel,b)}}};TGE.ObjectsManager=function(){this.mObjectsArray=[]};TGE.ObjectsManager.prototype={AddObject:function(a){this.mObjectsArray.push(a)},Update:function(a){for(var b=this.mObjectsArray.length-1;b>=0;b--){this.mObjectsArray[b].Update(a);if(this.mObjectsArray[b].MarkedForRemoval()){this.mObjectsArray[b].Cleanup();this.mObjectsArray.splice(b,1)}}},UpdateObjectsToScreen:function(){for(var a=0;a<this.mObjectsArray.length;a++){this.mObjectsArray[a].UpdateScreenPosition()}},NotifyObjectsOfClick:function(d,b){for(var c=0;c<this.mObjectsArray.length;c++){if(this.mObjectsArray[c].Visible()){var g=this.mObjectsArray[c].ScreenPosition().e(1);var f=this.mObjectsArray[c].ScreenPosition().e(2);var e=this.mObjectsArray[c].Width();var a=this.mObjectsArray[c].Height();if(d>g&&d<g+e&&b>f&&b<f+a){this.mObjectsArray[c].Click()}}}},NotifyObjectsOfMouseOver:function(d,b){for(var c=0;c<this.mObjectsArray.length;c++){if(this.mObjectsArray[c].Visible()){var g=this.mObjectsArray[c].ScreenPosition().e(1);var f=this.mObjectsArray[c].ScreenPosition().e(2);var e=this.mObjectsArray[c].Width();var a=this.mObjectsArray[c].Height();if(d>g&&d<g+e&&b>f&&b<f+a){this.mObjectsArray[c].mMouseOver=true;this.mObjectsArray[c].MouseOver()}else{if(this.mObjectsArray[c].mMouseOver){this.mObjectsArray[c].mMouseOver=false;this.mObjectsArray[c].MouseLeave()}}}}},NotifyObjectsOfMouseDown:function(d,b){for(var c=0;c<this.mObjectsArray.length;c++){if(this.mObjectsArray[c].Visible()){var g=this.mObjectsArray[c].ScreenPosition().e(1);var f=this.mObjectsArray[c].ScreenPosition().e(2);var e=this.mObjectsArray[c].Width();var a=this.mObjectsArray[c].Height();if(d>g&&d<g+e&&b>f&&b<f+a){this.mObjectsArray[c].MouseDown()}}}},NotifyObjectsOfMouseUp:function(d,b){for(var c=0;c<this.mObjectsArray.length;c++){if(this.mObjectsArray[c].Visible()){var g=this.mObjectsArray[c].ScreenPosition().e(1);var f=this.mObjectsArray[c].ScreenPosition().e(2);var e=this.mObjectsArray[c].Width();var a=this.mObjectsArray[c].Height();if(d>g&&d<g+e&&b>f&&b<f+a){this.mObjectsArray[c].MouseUp()}}}},Purge:function(){for(var a=this.mObjectsArray.length-1;a>=0;a--){this.mObjectsArray[a].Cleanup();this.mObjectsArray.splice(a,1)}},NumObjects:function(){return this.mObjectsArray.length}};TGE.AssetLoader=function(){this.mAssetList;this.mUpdateCallback;this.mCompleteCallback;return this};TGE.AssetLoader.prototype={LoadAssetList:function(c,b,e,d){this.mAssetList=b;this.mUpdateCallback=e;this.mCompleteCallback=d;var a=new PxLoader();if(b!=null&&b.loaded==false){for(i=0;i<b.list.length;i++){c.AddImage(b.list[i].id,a.addImage(b.list[i].url))}a.addProgressListener(TGE.AssetLoader.prototype.loaderCallback.bind(this));a.addCompletionListener(TGE.AssetLoader.prototype.completeCallback.bind(this));a.start()}else{if(this.mUpdateCallback!=null){this.mUpdateCallback(1)}if(this.mCompleteCallback!=null){this.mCompleteCallback.call()}}},loaderCallback:function(b){if(b.error){console.log("***** ERROR: could not load image '"+b.resource.getName()+"'")}if(this.mUpdateCallback!=null){var a=b.completedCount/b.totalCount;this.mUpdateCallback(a)}},completeCallback:function(){if(this.mAssetList!=null){this.mAssetList.loaded=true;this.mAssetList=null}if(this.mCompleteCallback!=null){this.mCompleteCallback()}}};TGE.SpriteAnimation=function(e,c,b,f,d,a){this.mFPS=d;this.mNumberOfFrames=f;this.mLooping=a;this.mAge=0;this.mPaused=false;this.mFinishedCallback=null;this.mFrameOffset=0;this.mCurrentFrame=0;this.mCompoundImage=new CAAT.CompoundImage().initialize(e,c,b)};TGE.SpriteAnimation.prototype={Play:function(a){this.mAge=0;this.mFinishedCallback=a},Pause:function(){this.mPaused=true},Resume:function(){this.mPaused=false},SetAnimationIndexOffset:function(a){this.mFrameOffset=a},Update:function(a){if(!this.mPaused){this.mAge+=a}var c=1/this.mFPS;var b=Math.floor(this.mAge/c);this.mCurrentFrame=0;if(this.mLooping||b<this.mNumberOfFrames){this.mCurrentFrame=b%this.mNumberOfFrames}else{this.mCurrentFrame=this.mNumberOfFrames-1;if(this.mFinishedCallback!=null){this.mFinishedCallback.call();this.mFinishedCallback=null}}this.mCurrentFrame+=this.mFrameOffset}};TGE.ScreenEntity=function(a){this.mGame=a;this.mLayer;this.mCAATContainer;this.mCameraCulling;this.mPosition=$V([0,0]);this.mScreenPosition=$V([0,0]);this.mVisible=true;this.mAge=0;this.mMarkedForRemoval=false;this.mLockXPosition=false;this.mAnimations={};this.mMouseOver=false;this.mScaleX=1;this.mScaleY=1};TGE.ScreenEntity.prototype={Setup:function(b,e,c,a){this.mPosition=$V([b,e]);this.mLayer=a;var d=this.mGame.GetImage(c);if(d==null){return this}this.CreateCAATContainer(CAAT.SpriteActor);this.SetImage(c);return this},SetImage:function(c,d,b){var e=this.mGame.GetImage(c);if(e==null){return}if(this.mCAATContainer==null){this.CreateCAATContainer(CAAT.SpriteActor)}d=typeof d!=="undefined"?d:1;b=typeof b!=="undefined"?b:1;var a=new CAAT.CompoundImage();a.initialize(e,d,b);this.mCAATContainer.setSpriteImage(a)},SetImageIndex:function(a){this.mCAATContainer.setSpriteIndex(a)},LoadAnimation:function(h,c,e,d,g,f,b){var a=new TGE.SpriteAnimation(this.mGame.GetImage(c),e,d,g,f,b);this.mAnimations[h]=a},PlayAnimation:function(b,a){if(this.mCurrentAnimation==this.mAnimations[b]){return}this.PlayAnimationFromStart(b,a)},PlayAnimationFromStart:function(c,a){if(this.mCAATContainer==null){this.CreateCAATContainer(CAAT.SpriteActor)}var b=this.mAnimations[c];if(b!=null){this.mCurrentAnimation=b;this.mCAATContainer.setSpriteImage(this.mCurrentAnimation.mCompoundImage);this.mCAATContainer.setSpriteIndex(0);this.mCurrentAnimation.Play(a);this.UpdateScreenPosition()}},Show:function(){this.mVisible=true;if(this.mCAATContainer!=null){this.mCAATContainer.visible=true}},Hide:function(){this.mVisible=false;if(this.mCAATContainer!=null){this.mCAATContainer.visible=false}},Visible:function(){return this.mVisible},Click:function(){},MouseOver:function(){},MouseLeave:function(){},MouseDown:function(){},MouseUp:function(){},SetPosition:function(a,b){this.mPosition=$V([a,b])},Position:function(){return this.mPosition},ScreenPosition:function(){return this.mScreenPosition},SetRotation:function(b,a,c){if(this.mCAATContainer!=null){if(a==null||c==null){this.mCAATContainer.setRotation(b)}else{this.mCAATContainer.setRotationAnchored(b,a,c)}}},SetScale:function(b,a){var c=a==null?b:a;this.mScaleX=b;this.mScaleY=c;if(this.mCAATContainer!=null){this.mCAATContainer.setScale(b,c)}},SetAlpha:function(a){if(this.mCAATContainer!=null){this.mCAATContainer.alpha=a}},Age:function(){return this.mAge},Update:function(a){this.mAge+=a;this.subclassUpdate(a);if(this.ShouldBeRemoved()){this.MarkForRemoval()}if(this.mCurrentAnimation!=null){this.mCurrentAnimation.Update(a);this.mCAATContainer.setSpriteIndex(this.mCurrentAnimation.mCurrentFrame)}},Width:function(){var a=this.mCAATContainer!=null?this.mCAATContainer.width:0;return a*this.mScaleX},Height:function(){var a=this.mCAATContainer!=null?this.mCAATContainer.height:0;return a*this.mScaleY},UpdateScreenPosition:function(){if(this.mGame!=null&&this.mCAATContainer!=null){var d=this.Width()/this.mScaleX/2;var b=this.Height()/this.mScaleY/2;var a=this.mPosition.e(1)-d;var c=this.mPosition.e(2)-b;this.setScreenPosition(a,c)}},setScreenPosition:function(b,a){this.mScreenPosition=$V([b,a]);this.mCAATContainer.setLocation(b,a)},Cleanup:function(){if(this.mCAATContainer!=null){this.mGame.RemoveCAATActorFromScene(this.mCAATContainer,this.mLayer)}this.subclassCleanup()},MarkForRemoval:function(){this.mMarkedForRemoval=true},MarkedForRemoval:function(){return this.mMarkedForRemoval},ShouldBeRemoved:function(){if(this.mCameraCulling!=null){var b=this.mPosition.e(1);var d=this.mPosition.e(2);var c=this.Width()/2;var a=this.Height()/2;if(this.mCameraCulling[0]&&this.mGame.ScreenY(d-a)<0){return true}if(this.mCameraCulling[1]&&this.mGame.ScreenX(b-c)>this.mGame.Width()){return true}if(this.mCameraCulling[2]&&this.mGame.ScreenY(d+a)>this.mGame.Height()){return true}if(this.mCameraCulling[3]&&this.mGame.ScreenX(b+c)<0){return true}}return this.subclassShouldBeRemoved()},CreateCAATContainer:function(a){if(this.mCAATContainer!=null){this.mGame.RemoveCAATActorFromScene(this.mCAATContainer,this.mLayer)}this.mCAATContainer=new a;a.prototype.constructor.apply(this.mCAATContainer,[this]);this.mGame.AddCAATActorToScene(this.mCAATContainer,this.mLayer)},subclassUpdate:function(a){},subclassShouldBeRemoved:function(){return false},subclassCleanup:function(){}};TGE.Button=function(a){TGE.ScreenEntity.call(this,a);this.mState="idle";this.mMouseOver=false;this.mMouseDown=false;this.mPressFunction};TGE.Button.prototype={Setup:function(b,f,e,d,c,a){this.mNumStates=c;TGE.ScreenEntity.prototype.Setup.call(this,b,f,null,a);this.SetImage(e,1,c);this.mPressFunction=d;this.setButtonState("idle");return this},Click:function(){if(!this.mMouseDown){return}if(this.mPressFunction!=null){this.mPressFunction.call(this)}},MouseOver:function(){this.mMouseOver=true},MouseDown:function(){this.mMouseDown=true},MouseUp:function(){},subclassUpdate:function(a){this.mMouseDown=this.mMouseDown&&this.mGame.IsMouseDown();if(this.mMouseOver){this.setButtonState(this.mMouseDown?"down":"hover")}else{this.setButtonState("idle")}this.mMouseOver=false},setButtonState:function(b){if(b==this.mState){return}this.mState=b;var a=0;switch(this.mState){case"disable":a=3;break;case"down":a=2;break;case"hover":a=1;break;case"idle":default:a=0;break}if(a<this.mNumStates){this.SetImageIndex(a)}}};extend(TGE.Button,TGE.ScreenEntity,null);TGE.Text=function(a){TGE.ScreenEntity.call(this,a);this.mTextActor};TGE.Text.prototype={Setup:function(b,h,f,e,d,g,c,a){TGE.ScreenEntity.prototype.Setup.call(this,b,h,null,a);this.mHorizontalAlignment=d;this.mVerticalAlignment=g;this.CreateCAATContainer(CAAT.ActorContainer);this.mTextActor=new CAAT.TextActor();this.mCAATContainer.addChild(this.mTextActor);this.mTextActor.setFont(e).setTextAlign("left").setTextBaseline("top").setText(f).setFillStyle(c);this.UpdateScreenPosition();return this},SetText:function(b,a){if(this.mTextActor==null){return}this.mTextActor.setText(b);if(a!=null){this.mTextActor.setFillStyle(a)}},UpdateScreenPosition:function(){if(this.mCAATContainer!=null){var b,d;var c=this.Width();var a=this.Height();switch(this.mHorizontalAlignment){case"left":b=this.mPosition.e(1);break;case"right":b=this.mPosition.e(1)-c;break;case"center":default:b=this.mPosition.e(1)-c/2;break}switch(this.mVerticalAlignment){case"top":d=this.mPosition.e(2);break;case"bottom":d=this.mPosition.e(2)-a;break;case"middle":default:d=this.mPosition.e(2)-a/2;break}this.setScreenPosition(b,d)}},Width:function(){return this.mTextActor.textWidth*this.mScaleX},Height:function(){return 30}};extend(TGE.Text,TGE.ScreenEntity,null);TGE.GameWorldEntity=function(a){TGE.ScreenEntity.call(this,a)};TGE.GameWorldEntity.prototype={CullToCamera:function(d,b,a,c){this.mCameraCulling=[d,b,a,c]},UpdateScreenPosition:function(){if(this.mCAATContainer!=null){var d=this.Width()/this.mScaleX/2;var b=this.Height()/this.mScaleY/2;var a=this.mPosition.e(1)-d;var c=this.mPosition.e(2)+b;a=this.mLockXPosition?a:this.mGame.ScreenX(a);c=this.mGame.ScreenY(c);this.setScreenPosition(a,c)}},SetPosition:function(a,b){this.mPosition=$V([a,b])},Position:function(){return this.mPosition},LockXPosition:function(){this.mLockXPosition=true}};extend(TGE.GameWorldEntity,TGE.ScreenEntity,null);TGE.Screen=function(a){this.mScreenManager=a;this.mBackground=null;this.mUIElements=new Array();this.mFrameCount=0;this.mDestroyed=false};TGE.Screen.prototype={Setup:function(){},Close:function(){this.mScreenManager.CloseScreen(this.constructor)},Game:function(){return this.mScreenManager.Game()},CreateUIEntity:function(a){var b=this.mScreenManager.CreateUIEntity(a);this.mUIElements.push(b);return b},DisplayNumber:function(l,s,r,j,p,q,e,m){var k=l.toString();var f=24;var h=2;var g=k.length*p;if(e){var d=Math.floor((k.length-1)/3);g+=d*f;g-=d*h}var b=q=="center"?s+g/2+p/2:s+g;b-=p;var a=r;var o=0;for(i=k.length-1;i>=0;i--){if(e&&o==3){b+=h;this.CreateUIEntity(TGE.ScreenEntity).Setup(b,a,"big_digits_comma",m);b-=f;o=0}var n=this.CreateUIEntity(TGE.ScreenEntity).Setup(b,a,null,m);n.SetImage(j,1,10);n.SetImageIndex(k.charCodeAt(i)-48);b-=p;o++}},FillBackground:function(a){this.mBackground=new CAAT.ActorContainer();this.mBackground.setBounds(0,0,this.mScreenManager.Game().Width(),this.mScreenManager.Game().Height());this.mBackground.setFillStyle(a);this.mScreenManager.Game().AddCAATActorToScene(this.mBackground,this.mScreenManager.mLayerName)},Finalize:function(){this.HideAll();for(var a=0;a<this.mUIElements.length;a++){this.mUIElements[a].UpdateScreenPosition()}},ShowAll:function(){for(var a=0;a<this.mUIElements.length;a++){this.mUIElements[a].Show()}},HideAll:function(){for(var a=0;a<this.mUIElements.length;a++){this.mUIElements[a].Hide()}},Update:function(a){this.mFrameCount++;if(this.mFrameCount==5){this.ShowAll()}},Destroy:function(){if(this.mBackground!=null){this.mScreenManager.Game().RemoveCAATActorFromScene(this.mBackground,this.mScreenManager.mLayerName)}for(var a=0;a<this.mUIElements.length;a++){this.mUIElements[a].MarkForRemoval()}this.mDestroyed=true}};TGE.ScreenManager=function(a){this.mGame=a;this.mLayerName="ScreenManager";this.mScreens=new Array();this.mBlackout=null;this.mBlackoutAlpha=1};TGE.ScreenManager.prototype={Initialize:function(b){for(var a in this.mScreens){if(this.mScreens[a]!=null){this.mScreens[a].Destroy();this.mScreens[a]=null}}b.CreateLayer(this.mLayerName);b.CreateLayer("Fade");this.mBlackout=b.CreateUIEntity(TGE.ScreenEntity).Setup(b.Width()/2,b.Height()/2,"screen_fade","Fade");this.mBlackout.SetScale(8)},CreateUIEntity:function(a){return this.mGame.CreateUIEntity(a)},ShowScreen:function(c,a){var b=new c;c.prototype.constructor.apply(b,[this]);this.mScreens[c.name]=b;b.Setup();b.Finalize();if(a!=false){this.ResetFade()}return b},CloseScreen:function(b){var a=this.mScreens[b.name];if(a==null){return}a.Destroy();this.mScreens[b]=null},ResetFade:function(){this.mBlackoutAlpha=1;this.mBlackout.SetAlpha(1);this.mBlackout.Show()},Update:function(b){this.mBlackoutAlpha-=b*3;if(this.mBlackoutAlpha<=0){this.mBlackoutAlpha=0;this.mBlackout.Hide()}this.mBlackout.SetAlpha(this.mBlackoutAlpha);for(var a in this.mScreens){if(this.mScreens[a]!=null){this.mScreens[a].Update(b)}}},Game:function(){return this.mGame},XFromPercentage:function(a){return this.mGame.Width()*a},YFromPercentage:function(a){return this.mGame.Height()*a},FixedDistanceFromTop:function(a){return a},FixedDistanceFromBottom:function(a){return this.mGame.Height()-a},FixedDistanceFromLeft:function(a){return a},FixedDistanceFromRight:function(a){return this.mGame.Width()-a}};TGE.Analytics=function(a){this.mGameName=a;return this};TGE.Analytics.prototype={LogGameEvent:function(a,e,b){var d=this.mGameName;if((a=="pause"||a=="resume")&&e!=null&&e>0){d+=(" - level "+e.toString())}var c="ANALYTIC EVENT: game, "+a+", "+d;if(a=="load"){c+=(", "+b.toString())}window.console.log(c)},LogShareEvent:function(a,d){var c=this.mGameName;if(d!=null&&d>0){c+=(" - level "+d.toString())}var b="ANALYTIC EVENT: share, "+a+", "+c;window.console.log(b)},LogLevelEvent:function(a,e,b){var d=this.mGameName;if(e!=null&&e>0){d+=(" - level "+e.toString())}var c="ANALYTIC EVENT: level, "+a+", "+d;if((a=="complete"||a=="fail")&&b!=null){c+=(", "+b.toString())}window.console.log(c)},LogAchievementEvent:function(b,e,a){var d=this.mGameName;if(e!=null&&e>0){d+=(" - level "+e.toString())}var c="ANALYTIC EVENT: achievement, "+b+", "+d;if(a!=null){c+=(", "+a.toString())}window.console.log(c)},LogClickThruEvent:function(a,d){var c=this.mGameName;if(d!=null&&d>0){c+=(" - level "+d.toString())}var b="ANALYTIC EVENT: clickthru, "+a+", "+c;window.console.log(b)},LogCustomEvent:function(a,e,b){var d=this.mGameName;if(e!=null&&e>0){d+=(" - level "+e.toString())}var c="ANALYTIC EVENT: custom, "+a+", "+d;if(b!=null){c+=(", "+b.toString())}window.console.log(c)}};TGE.GoogleAnalytics=function(a){TGE.GoogleAnalytics.superclass.constructor.call(this,a);return this};TGE.GoogleAnalytics.prototype={LogGameEvent:function(g,a,j){try{var d=this.mGameName;if(g=="pause"||g=="resume"&&a!=null&&a>0){d+=(" - level "+a.toString())}var k="game";var f=g;var b=d;var c=j;_gaq.push(["_trackEvent",k,f,b,c])}catch(h){console.log("GoogleAnalytics game event error: "+h.toString())}},LogShareEvent:function(b,j){try{var g=this.mGameName;if(j!=null&&j>0){g+=(" - level "+j.toString())}var a="share";var f=b;var c=g;var h=null;_gaq.push(["_trackEvent",a,f,c,h])}catch(d){console.log("GoogleAnalytics share event error: "+d.toString())}},LogLevelEvent:function(h,a,f){try{var d=this.mGameName;if(a!=null&&a>0){d+=(" - level "+a.toString())}var k="level";var g=h;var b=d;var c;if(h=="complete"||h=="fail"&&f!=null){c=f}_gaq.push(["_trackEvent",k,g,b,c])}catch(j){console.log("GoogleAnalytics level event error: "+j.toString())}},LogAchievementEvent:function(d,a,j){try{var f=this.mGameName;if(a!=null&&a>0){f+=(" - level "+a.toString())}var k="achievement";var g=d;var b=f;var c=j;_gaq.push(["_trackEvent",k,g,b,c])}catch(h){console.log("GoogleAnalytics achievement event error: "+h.toString())}},LogClickThruEvent:function(b,j){try{var g=this.mGameName;if(j!=null&&j>0){g+=(" - level "+j.toString())}var a="clickthru";var f=b;var c=g;var h=null;_gaq.push(["_trackEvent",a,f,c,h])}catch(d){console.log("GoogleAnalytics clickthru event error: "+d.toString())}},LogCustomEvent:function(g,a,j){try{var d=this.mGameName;if(a!=null&&a>0){d+=(" - level "+a.toString())}var k="custom";var f=g;var b=d;var c=j;_gaq.push(["_trackEvent",k,f,b,c])}catch(h){console.log("GoogleAnalytics custom event error: "+h.toString())}}};extend(TGE.GoogleAnalytics,TGE.Analytics,null);TGE.ParallaxPane=function(a){TGE.GameWorldEntity.call(this,a);this.mTrackingSpeed=1;this.mPane1=null;this.mPane2=null;this.mHorizontalOffset=0};TGE.ParallaxPane.prototype={Setup:function(a,d,c,b){TGE.GameWorldEntity.prototype.Setup.call(this,0,a,null,b);this.CreateCAATContainer(CAAT.ActorContainer);this.mTrackingSpeed=d;this.mPane1=new CAAT.ActorContainer().setBackgroundImage(this.mGame.GetImage(c),true);this.mCAATContainer.addChild(this.mPane1);this.mPane1.setLocation(0,0);this.mPane2=new CAAT.ActorContainer().setBackgroundImage(this.mGame.GetImage(c),true);this.mCAATContainer.addChild(this.mPane2);this.mPane2.setLocation(this.mGame.Width(),0);return this},SetHorizontalOffset:function(a){this.mHorizontalOffset=a},UpdateScreenPosition:function(){if(this.mPane1!=null&&this.mPane2!=null){var c=this.mGame.CameraLocation().e(1);var a=(-c+this.mHorizontalOffset)*this.mTrackingSpeed/this.mScaleX;var b=this.mGame.Width()/this.mScaleX;this.mPane1.setLocation(a%b,this.mGame.ScreenY(this.mPosition.e(2)));this.mPane2.setLocation(this.mPane1.x+b,this.mGame.ScreenY(this.mPosition.e(2)))}}};extend(TGE.ParallaxPane,TGE.GameWorldEntity,null);TGE.BrowserDetect=function(){this.init();return this};TGE.BrowserDetect.prototype={browser:"",version:0,OSOrDevices:"",OSversion:0,detectOSversion:function(b){var d="-1";var c="";var a=navigator.userAgent.toString();switch(b){case"Windows Phone":c=/Windows Phone OS\s+[\d\.]+/;d=String(a.match(c)).substring(17,20);break;case"iPhone":case"iPad":c=/OS\s+[\d\_]+/;d=String(a.match(c)).substring(3,6);break;case"Windows":c=/Windows NT\s+[\d\.]+/;if(String(a.match(c)).substring(11,14)=="6.1"){d="7"}else{if(String(a.match(c)).substring(11,14)=="5.1"){d="XP"}else{if(String(a.match(c)).substring(11,14)=="5.2"){d="XP"}else{if(String(a.match(c)).substring(11,14)=="6.0"){d="Vista"}else{if(String(a.match(c)).substring(11,15)=="5.01"){d="2000 SP1"}else{if(String(a.match(c)).substring(11,14)=="5.0"){d="2000"}}}}}}break;case"Mac":c=/Mac OS X\s+[\d\_]+/;d=String(a.match(c)).substring(9,13);break;case"Android":c=/ndroid\s+[\d\.]+/;d=String(a.match(c)).substring(7,10);break}return d},init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OSOrDevices=this.searchString(this.dataOSOrDevices)||"an unknown OS or Device";this.OSversion=this.detectOSversion(this.OSOrDevices)},searchString:function(d){for(var a=0;a<d.length;a++){if(d[a]!=null){var b=d[a].string;var c=d[a].prop;this.versionSearchString=d[a].versionSearch||d[a].identity;if(b){if(b.indexOf(d[a].subString)!==-1){return d[a].identity}}else{if(c){return d[a].identity}}}}},searchVersion:function(b){var a=b.indexOf(this.versionSearchString);if(a===-1){return}return parseFloat(b.substring(a+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Explorer",identity:"Explorer",versionSearch:"Explorer"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{prop:window.opera,identity:"Opera"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.vendor,subString:"BlackBerry",identity:"BlackBerry"}],dataOSOrDevices:[{string:navigator.platform,subString:"Windows Phone",identity:"Windows Phone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.userAgent,subString:"iPad",identity:"iPad"},{string:navigator.userAgent,subString:"iPod",identity:"iPod"},{string:navigator.userAgent,subString:"Android",identity:"Android"},,{string:navigator.userAgent,subString:"webOS",identity:"webOS"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};(function(){TGE.PlatformCompatibility=function(){return this};TGE.PlatformCompatibility.prototype={isAudioSupported:function(){var b=document.createElement("audio"),a=false;try{if(a=!!b.canPlayType){a=new Boolean(a);a.ogg=b.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"");a.mp3=b.canPlayType("audio/mpeg;").replace(/^no$/,"");a.wav=b.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"");a.m4a=(b.canPlayType("audio/x-m4a;")||b.canPlayType("audio/aac;")).replace(/^no$/,"")}}catch(c){}return a},isAudioFormatSupported:function(a){var d=document.createElement("audio"),b=false;var c;try{if(b=!!d.canPlayType){b=new Boolean(b);switch(a){case"ogg":c=d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"");break;case"mp3":c=d.canPlayType("audio/mpeg;").replace(/^no$/,"");break;case"wav":c=d.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"");break;case"m4a":c=(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/aac;")).replace(/^no$/,"");break;default:break}}}catch(f){}return c},isCanvasSupported:function(){var a=document.createElement("canvas");return !!(a.getContext&&a.getContext("2d"))},isVideoSupported:function(){var b=document.createElement("video"),a=false;try{if(a=!!b.canPlayType){a=new Boolean(a);a.ogg=b.canPlayType('video/ogg; codecs="theora"');a.h264=b.canPlayType('video/mp4; codecs="avc1.42E01E"');a.webm=b.canPlayType('video/webm; codecs="vp8, vorbis"')}}catch(c){}return a},isDragAndDropSupported:function(){var a=document.createElement("div");bool=("draggable" in a)||("ondragstart" in a&&"ondrop" in a);return bool},isGeolocationSupported:function(){return !!navigator.geolocation},isWebGlSupported:function(){try{var b=document.createElement("canvas"),a;a=!!(window.WebGLRenderingContext&&(b.getContext("experimental-webgl")||b.getContext("webgl")));b=undefined}catch(c){a=false}return a},isHistorySupported:function(){return !!(window.history&&history.pushState)},isVideoSupported:function(){var b=document.createElement("video"),a=false},isLocalStorageSupported:function(){try{localStorage.setItem(mod,mod);localStorage.removeItem(mod);return true}catch(a){return false}},isSessionStorageSupported:function(){try{sessionStorage.setItem(mod,mod);sessionStorage.removeItem(mod);return true}catch(a){return false}},isSVGSupported:function(){ns={svg:"http://www.w3.org/2000/svg"};return !!document.createElementNS&&!!document.createElementNS(ns.svg,"svg").createSVGRect}}})();(function(){TGE.DeviceOrientation=function(){return this};TGE.DeviceOrientation.prototype={orientationChangeCallBack:null,RegisterOrientationChange:function(a){TGE.DeviceOrientation.prototype.orientationChangeCallBack=a;window.addEventListener("orientationchange",TGE.DeviceOrientation.prototype.internalOrientationChanged);TGE.DeviceOrientation.prototype.internalOrientationChanged()},internalOrientationChanged:function(){if(window.orientation==0||window.orientation==180){TGE.DeviceOrientation.prototype.orientationChangeCallBack("portrait")}else{TGE.DeviceOrientation.prototype.orientationChangeCallBack("landscape")}},}})();function getElementPosition(b){var c=b;var d="";var a=0;var e=0;if(c==null){return null}while((typeof(c)=="object")&&(typeof(c.tagName)!="undefined")){e+=c.offsetTop;a+=c.offsetLeft;d=c.tagName.toUpperCase();if(d=="BODY"){c=0}if(typeof(c)=="object"){if(typeof(c.offsetParent)=="object"){c=c.offsetParent}}if(c==null){return null}}return{x:a,y:e}};