/*
 jquery-comments.js 1.5.0

     (c) 2017 Joona Tykkyl?inen, Viima Solutions Oy
     jquery-comments may be freely distributed under the MIT license.
     For all details and documentation:
     http://viima.github.io/jquery-comments/
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,h,a){c instanceof String&&(c=String(c));for(var b=c.length,d=0;d<b;d++){var e=c[d];if(h.call(a,e,d,c))return{i:d,v:e}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,h,a){c!=Array.prototype&&c!=Object.prototype&&(c[h]=a.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(c,h,a,b){if(h){a=$jscomp.global;c=c.split(".");for(b=0;b<c.length-1;b++){var d=c[b];d in a||(a[d]={});a=a[d]}c=c[c.length-1];b=a[c];h=h(b);h!=b&&null!=h&&$jscomp.defineProperty(a,c,{configurable:!0,writable:!0,value:h})}};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,a){return $jscomp.findInternal(this,c,a).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(c){var h=0;return function(){return h<c.length?{done:!1,value:c[h++]}:{done:!0}}};
$jscomp.arrayIterator=function(c){return{next:$jscomp.arrayIteratorImpl(c)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(c,h){this.$jscomp$symbol$id_=c;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:h})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function c(a){if(this instanceof c)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(a||"")+"_"+h++,a)}var h=0;return c}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.asyncIterator;c||(c=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};
$jscomp.iteratorFromArray=function(c,h){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var a=0,b={next:function(){if(a<c.length){var d=a++;return{value:h(d,c[d]),done:!1}}b.next=function(){return{done:!0,value:void 0}};return b.next()}};b[Symbol.iterator]=function(){return b};return b};$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6","es3");
(function(c){"function"===typeof define&&define.amd?define(["jquery"],c):"object"===typeof module&&module.exports?module.exports=function(h,a){void 0===a&&(a="undefined"!==typeof window?require("jquery"):require("jquery")(h));c(a);return a}:c(jQuery)})(function(c){var h={$el:null,commentsById:{},dataFetched:!1,currentSortKey:"",options:{},events:{click:"closeDropdowns",paste:"preSavePastedAttachments","keydown [contenteditable]":"saveOnKeydown","focus [contenteditable]":"saveEditableContent","keyup [contenteditable]":"checkEditableContentForChange",
"paste [contenteditable]":"checkEditableContentForChange","input [contenteditable]":"checkEditableContentForChange","blur [contenteditable]":"checkEditableContentForChange","click .navigation li[data-sort-key]":"navigationElementClicked","click .navigation li.title":"toggleNavigationDropdown","click .commenting-field.main .textarea":"showMainCommentingField","click .commenting-field.main .close":"hideMainCommentingField","click .commenting-field .textarea":"increaseTextareaHeight","change .commenting-field .textarea":"increaseTextareaHeight textareaContentChanged",
"click .commenting-field:not(.main) .close":"removeCommentingField","click .commenting-field .send.enabled":"postComment","click .commenting-field .update.enabled":"putComment","click .commenting-field .delete.enabled":"deleteComment","click .commenting-field .attachments .attachment .delete":"preDeleteAttachment",'change .commenting-field .upload.enabled input[type="file"]':"fileInputChanged","click li.comment button.upvote":"upvoteComment","click li.comment button.delete.enabled":"deleteComment",
"click li.comment .hashtag":"hashtagClicked","click li.comment .ping":"pingClicked","click li.comment ul.child-comments .toggle-all":"toggleReplies","click li.comment button.reply":"replyButtonClicked","click li.comment button.edit":"editButtonClicked",dragenter:"showDroppableOverlay","dragenter .droppable-overlay":"handleDragEnter","dragleave .droppable-overlay":"handleDragLeaveForOverlay","dragenter .droppable-overlay .droppable":"handleDragEnter","dragleave .droppable-overlay .droppable":"handleDragLeaveForDroppable",
"dragover .droppable-overlay":"handleDragOverForOverlay","drop .droppable-overlay":"handleDrop","click .dropdown.autocomplete":"stopPropagation","mousedown .dropdown.autocomplete":"stopPropagation","touchstart .dropdown.autocomplete":"stopPropagation"},getDefaultOptions:function(){return{profilePictureURL:"",currentUserIsAdmin:!1,currentUserId:null,spinnerIconURL:"",upvoteIconURL:"",replyIconURL:"",uploadIconURL:"",attachmentIconURL:"",noCommentsIconURL:"",closeIconURL:"",textareaPlaceholderText:"Add a comment",
newestText:"Newest",oldestText:"Oldest",popularText:"Popular",attachmentsText:"Attachments",sendText:"Send",replyText:"Reply",editText:"Edit",editedText:"Edited",youText:"You",saveText:"Save",deleteText:"Delete",newText:"New",viewAllRepliesText:"View all __replyCount__ replies",hideRepliesText:"Hide replies",noCommentsText:"No comments",noAttachmentsText:"No attachments",attachmentDropText:"Drop files here",textFormatter:function(a){return a},enableReplying:!0,enableEditing:!0,enableUpvoting:!0,enableDeleting:!0,
enableAttachments:!1,enableHashtags:!1,enablePinging:!1,enableDeletingCommentWithReplies:!1,enableNavigation:!0,postCommentOnEnter:!1,forceResponsive:!1,readOnly:!1,defaultNavigationSortKey:"newest",highlightColor:"#2793e6",deleteButtonColor:"#C9302C",scrollContainer:this.$el,roundProfilePictures:!1,textareaRows:2,textareaRowsOnFocus:2,textareaMaxRows:5,maxRepliesVisible:2,fieldMappings:{id:"id",parent:"parent",created:"created",modified:"modified",content:"content",attachments:"attachments",pings:"pings",
creator:"creator",fullname:"fullname",profilePictureURL:"profile_picture_url",isNew:"is_new",createdByAdmin:"created_by_admin",createdByCurrentUser:"created_by_current_user",upvoteCount:"upvote_count",userHasUpvoted:"user_has_upvoted"},searchUsers:function(a,b,c){b([])},getComments:function(a,b){a([])},postComment:function(a,b,c){b(a)},putComment:function(a,b,c){b(a)},deleteComment:function(a,b,c){b()},upvoteComment:function(a,b,c){b(a)},validateAttachments:function(a,b){return b(a)},hashtagClicked:function(a){},
pingClicked:function(a){},refresh:function(){},timeFormatter:function(a){return(new Date(a)).toLocaleDateString()}}},init:function(a,b){this.$el=c(b);this.$el.addClass("jquery-comments");this.undelegateEvents();this.delegateEvents();b=navigator.userAgent||navigator.vendor||window.opera;(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,
4));c.browser.mobile&&this.$el.addClass("mobile");this.options=c.extend(!0,{},this.getDefaultOptions(),a);this.options.readOnly&&this.$el.addClass("read-only");this.currentSortKey=this.options.defaultNavigationSortKey;this.createCssDeclarations();this.fetchDataAndRender()},delegateEvents:function(){this.bindEvents(!1)},undelegateEvents:function(){this.bindEvents(!0)},bindEvents:function(a){a=a?"off":"on";for(var b in this.events){var d=b.split(" ")[0],e=b.split(" ").slice(1).join(" "),f=this.events[b].split(" "),
k;for(k in f)if(f.hasOwnProperty(k)){var g=this[f[k]];g=c.proxy(g,this);if(""==e)this.$el[a](d,g);else this.$el[a](d,e,g)}}},fetchDataAndRender:function(){var a=this;this.commentsById={};this.$el.empty();this.createHTML();this.options.getComments(function(b){b=b.map(function(b){return a.createCommentModel(b)});a.sortComments(b,"oldest");c(b).each(function(b,c){a.addCommentToDataModel(c)});a.dataFetched=!0;a.render()})},fetchNext:function(){var a=this,b=this.createSpinner();this.$el.find("ul#comment-list").append(b);
this.options.getComments(function(d){c(d).each(function(b,c){a.createComment(c)});b.remove()},function(){b.remove()})},createCommentModel:function(a){var b=this.applyInternalMappings(a);b.childs=[];b.hasAttachments=function(){return 0<b.attachments.length};return b},addCommentToDataModel:function(a){a.id in this.commentsById||(this.commentsById[a.id]=a,a.parent&&this.getOutermostParent(a.parent).childs.push(a.id))},updateCommentModel:function(a){c.extend(this.commentsById[a.id],a)},render:function(){this.dataFetched&&
(this.showActiveContainer(),this.createComments(),this.options.enableAttachments&&this.options.enableNavigation&&this.createAttachments(),this.$el.find("> .spinner").remove(),this.options.refresh())},showActiveContainer:function(){var a=this.$el.find(".navigation li[data-container-name].active").data("container-name");a=this.$el.find('[data-container="'+a+'"]');a.siblings("[data-container]").hide();a.show()},createComments:function(){var a=this;this.$el.find("#comment-list").remove();var b=c("<ul/>",
{id:"comment-list","class":"main"}),d=[],e=[];c(this.getComments()).each(function(a,b){null==b.parent?d.push(b):e.push(b)});this.sortComments(d,this.currentSortKey);c(d).each(function(c,d){a.addComment(d,b)});this.sortComments(e,"oldest");c(e).each(function(c,d){a.addComment(d,b)});this.$el.find('[data-container="comments"]').prepend(b)},createAttachments:function(){var a=this;this.$el.find("#attachment-list").remove();var b=c("<ul/>",{id:"attachment-list","class":"main"}),d=this.getAttachments();
this.sortComments(d,"newest");c(d).each(function(c,d){a.addAttachment(d,b)});this.$el.find('[data-container="attachments"]').prepend(b)},addComment:function(a,b,c){b=b||this.$el.find("#comment-list");var d=this.createCommentElement(a);a.parent?(b=b.find('.comment[data-id="'+a.parent+'"]'),this.reRenderCommentActionBar(a.parent),a=b.parents(".comment").last(),0==a.length&&(a=b),b=a.find(".child-comments"),c=b.find(".commenting-field"),c.length?c.before(d):b.append(d),this.updateToggleAllButton(a)):
c?b.prepend(d):b.append(d)},addAttachment:function(a,b){b=b||this.$el.find("#attachment-list");a=this.createCommentElement(a);b.prepend(a)},removeComment:function(a){var b=this,d=this.commentsById[a],e=this.getChildComments(d.id);c(e).each(function(a,c){b.removeComment(c.id)});d.parent&&(e=this.getOutermostParent(d.parent),d=e.childs.indexOf(d.id),e.childs.splice(d,1));delete this.commentsById[a];a=this.$el.find('li.comment[data-id="'+a+'"]');d=a.parents("li.comment").last();a.remove();this.updateToggleAllButton(d)},
preDeleteAttachment:function(a){var b=c(a.currentTarget).parents(".commenting-field").first();c(a.currentTarget).parents(".attachment").first().remove();this.toggleSaveButton(b)},preSaveAttachments:function(a,b){var d=this;if(a.length){b||(b=this.$el.find(".commenting-field.main"));var e=b.find(".control-row .upload");b.hasClass("main");var f=b.find(".control-row .attachments");a=c(a).map(function(a,b){return{mime_type:b.type,file:b}});var k=this.getAttachmentsFromCommentingField(b);a=a.filter(function(a,
b){var d=!1;c(k).each(function(a,c){b.file.name==c.file.name&&b.file.size==c.file.size&&(d=!0)});return!d});b.hasClass("main")&&b.find(".textarea").trigger("click");this.setButtonState(e,!1,!0);this.options.validateAttachments(a,function(a){a.length&&(c(a).each(function(a,b){a=d.createAttachmentTagElement(b,!0);f.append(a)}),d.toggleSaveButton(b));d.setButtonState(e,!0,!1)})}e.find("input").val("")},updateToggleAllButton:function(a){if(null!=this.options.maxRepliesVisible){a=a.find(".child-comments");
var b=a.find(".comment").not(".hidden"),d=a.find("li.toggle-all");b.removeClass("togglable-reply");var e=0===this.options.maxRepliesVisible?b:b.slice(0,-this.options.maxRepliesVisible);e.addClass("togglable-reply");d.find("span.text").text()==this.options.textFormatter(this.options.hideRepliesText)&&e.addClass("visible");b.length>this.options.maxRepliesVisible?(d.length||(d=c("<li/>",{"class":"toggle-all highlight-font-bold"}),b=c("<span/>",{"class":"text"}),e=c("<span/>",{"class":"caret"}),d.append(b).append(e),
a.prepend(d)),this.setToggleAllButtonText(d,!1)):d.remove()}},updateToggleAllButtons:function(){var a=this,b=this.$el.find("#comment-list");b.find(".comment").removeClass("visible");b.children(".comment").each(function(b,e){a.updateToggleAllButton(c(e))})},sortComments:function(a,b){var c=this;"popularity"==b?a.sort(function(a,b){var d=a.childs.length,e=b.childs.length;c.options.enableUpvoting&&(d+=a.upvoteCount,e+=b.upvoteCount);if(e!=d)return e-d;a=(new Date(a.created)).getTime();return(new Date(b.created)).getTime()-
a}):a.sort(function(a,c){a=(new Date(a.created)).getTime();c=(new Date(c.created)).getTime();return"oldest"==b?a-c:c-a})},sortAndReArrangeComments:function(a){var b=this.$el.find("#comment-list"),d=this.getComments().filter(function(a){return!a.parent});this.sortComments(d,a);c(d).each(function(a,c){a=b.find("> li.comment[data-id="+c.id+"]");b.append(a)})},showActiveSort:function(){var a=this.$el.find('.navigation li[data-sort-key="'+this.currentSortKey+'"]');this.$el.find(".navigation li").removeClass("active");
a.addClass("active");var b=this.$el.find(".navigation .title");"attachments"!=this.currentSortKey?(b.addClass("active"),b.find("header").html(a.first().html())):(a=this.$el.find(".navigation ul.dropdown").children().first(),b.find("header").html(a.html()));this.showActiveContainer()},forceResponsive:function(){this.$el.addClass("responsive")},closeDropdowns:function(){this.$el.find(".dropdown").hide()},preSavePastedAttachments:function(a){var b=a.originalEvent.clipboardData.files;if(b&&1==b.length){var d,
e=c(a.target).parents(".commenting-field").first();e.length&&(d=e);this.preSaveAttachments(b,d);a.preventDefault()}},saveOnKeydown:function(a){if(13==a.keyCode){var b=a.metaKey||a.ctrlKey;if(this.options.postCommentOnEnter||b)c(a.currentTarget).siblings(".control-row").find(".save").trigger("click"),a.stopPropagation(),a.preventDefault()}},saveEditableContent:function(a){a=c(a.currentTarget);a.data("before",a.html())},checkEditableContentForChange:function(a){a=c(a.currentTarget);c(a[0].childNodes).each(function(){this.nodeType==
Node.TEXT_NODE&&0==this.length&&this.removeNode&&this.removeNode()});a.data("before")!=a.html()&&(a.data("before",a.html()),a.trigger("change"))},navigationElementClicked:function(a){a=c(a.currentTarget).data().sortKey;"attachments"==a?this.createAttachments():this.sortAndReArrangeComments(a);this.currentSortKey=a;this.showActiveSort()},toggleNavigationDropdown:function(a){a.stopPropagation();c(a.currentTarget).find("~ .dropdown").toggle()},showMainCommentingField:function(a){a=c(a.currentTarget);
a.siblings(".control-row").show();a.parent().find(".close").show();a.parent().find(".upload.inline-button").hide();a.focus()},hideMainCommentingField:function(a){a=c(a.currentTarget);var b=this.$el.find(".commenting-field.main"),d=b.find(".textarea"),e=b.find(".control-row");this.clearTextarea(d);b.find(".attachments").empty();this.toggleSaveButton(b);this.adjustTextareaHeight(d,!1);e.hide();a.hide();d.parent().find(".upload.inline-button").show();d.blur()},increaseTextareaHeight:function(a){a=c(a.currentTarget);
this.adjustTextareaHeight(a,!0)},textareaContentChanged:function(a){a=c(a.currentTarget);if(!a.find(".reply-to.tag").length)if(a.attr("data-comment")){var b=a.parents("li.comment");1<b.length&&(b=b.last().data("id"),a.attr("data-parent",b))}else b=a.parents("li.comment").last().data("id"),a.attr("data-parent",b);b=a.parents(".commenting-field").first();a[0].scrollHeight>a.outerHeight()?b.addClass("commenting-field-scrollable"):b.removeClass("commenting-field-scrollable");this.toggleSaveButton(b)},
toggleSaveButton:function(a){var b=a.find(".textarea"),c=b.siblings(".control-row").find(".save"),e=this.getTextareaContent(b,!0);a=this.getAttachmentsFromCommentingField(a);if(commentModel=this.commentsById[b.attr("data-comment")]){e=e!=commentModel.content;var f;commentModel.parent&&(f=commentModel.parent.toString());b=b.attr("data-parent")!=f;f=!1;this.options.enableAttachments&&(f=commentModel.attachments.map(function(a){return a.id}),a=a.map(function(a){return a.id}),f=!this.areArraysEqual(f,
a));a=e||b||f}else a=!!e.length||!!a.length;c.toggleClass("enabled",a)},removeCommentingField:function(a){a=c(a.currentTarget);a.siblings(".textarea").attr("data-comment")&&a.parents("li.comment").first().removeClass("edit");a.parents(".commenting-field").first().remove()},postComment:function(a){var b=this,d=c(a.currentTarget),e=d.parents(".commenting-field").first();this.setButtonState(d,!1,!0);a=this.createCommentJSON(e);a=this.applyExternalMappings(a);this.options.postComment(a,function(a){b.createComment(a);
e.find(".close").trigger("click");b.setButtonState(d,!1,!1)},function(){b.setButtonState(d,!0,!1)})},createComment:function(a){a=this.createCommentModel(a);this.addCommentToDataModel(a);var b=this.$el.find("#comment-list");this.addComment(a,b,"newest"==this.currentSortKey);"attachments"==this.currentSortKey&&a.hasAttachments()&&this.addAttachment(a)},putComment:function(a){var b=this,d=c(a.currentTarget),e=d.parents(".commenting-field").first();a=e.find(".textarea");this.setButtonState(d,!1,!0);var f=
c.extend({},this.commentsById[a.attr("data-comment")]);c.extend(f,{parent:a.attr("data-parent")||null,content:this.getTextareaContent(a),pings:this.getPings(a),modified:(new Date).getTime(),attachments:this.getAttachmentsFromCommentingField(e)});f=this.applyExternalMappings(f);this.options.putComment(f,function(a){a=b.createCommentModel(a);delete a.childs;b.updateCommentModel(a);e.find(".close").trigger("click");b.reRenderComment(a.id);b.setButtonState(d,!1,!1)},function(){b.setButtonState(d,!0,!1)})},
deleteComment:function(a){var b=this,d=c(a.currentTarget);a=d.parents(".comment").first();a=c.extend({},this.commentsById[a.attr("data-id")]);var e=a.id,f=a.parent;this.setButtonState(d,!1,!0);a=this.applyExternalMappings(a);this.options.deleteComment(a,function(){b.removeComment(e);f&&b.reRenderCommentActionBar(f);b.setButtonState(d,!1,!1)},function(){b.setButtonState(d,!0,!1)})},hashtagClicked:function(a){a=c(a.currentTarget).attr("data-value");this.options.hashtagClicked(a)},pingClicked:function(a){a=
c(a.currentTarget).attr("data-value");this.options.pingClicked(a)},fileInputChanged:function(a,b){b=a.currentTarget.files;a=c(a.currentTarget).parents(".commenting-field").first();this.preSaveAttachments(b,a)},upvoteComment:function(a){var b=this,d=c(a.currentTarget).parents("li.comment").first().data().model,e=d.upvoteCount;a=d.userHasUpvoted?e-1:e+1;d.userHasUpvoted=!d.userHasUpvoted;d.upvoteCount=a;this.reRenderUpvotes(d.id);a=c.extend({},d);a=this.applyExternalMappings(a);this.options.upvoteComment(a,
function(a){a=b.createCommentModel(a);b.updateCommentModel(a);b.reRenderUpvotes(a.id)},function(){d.userHasUpvoted=!d.userHasUpvoted;d.upvoteCount=e;b.reRenderUpvotes(d.id)})},toggleReplies:function(a){a=c(a.currentTarget);a.siblings(".togglable-reply").toggleClass("visible");this.setToggleAllButtonText(a,!0)},replyButtonClicked:function(a){var b=c(a.currentTarget);a=b.parents("li.comment").last();var d=b.parents(".comment").first().data().id;b=a.find(".child-comments > .commenting-field");b.length&&
b.remove();b.find(".textarea").attr("data-parent")!=d&&(b=this.createCommentingFieldElement(d),a.find(".child-comments").append(b),a=b.find(".textarea"),this.moveCursorToEnd(a),this.ensureElementStaysVisible(b))},editButtonClicked:function(a){var b=c(a.currentTarget).parents("li.comment").first();a=b.data().model;b.addClass("edit");var d=this.createCommentingFieldElement(a.parent,a.id);b.find(".comment-wrapper").first().append(d);b=d.find(".textarea");b.attr("data-comment",a.id);b.append(this.getFormattedCommentContent(a,
!0));this.moveCursorToEnd(b);this.ensureElementStaysVisible(d)},showDroppableOverlay:function(a){this.options.enableAttachments&&(this.$el.find(".droppable-overlay").css("top",this.$el[0].scrollTop),this.$el.find(".droppable-overlay").show(),this.$el.addClass("drag-ongoing"))},handleDragEnter:function(a){var b=c(a.currentTarget).data("dnd-count")||0;b++;c(a.currentTarget).data("dnd-count",b);c(a.currentTarget).addClass("drag-over")},handleDragLeave:function(a,b){var d=c(a.currentTarget).data("dnd-count");
d--;c(a.currentTarget).data("dnd-count",d);0==d&&(c(a.currentTarget).removeClass("drag-over"),b&&b())},handleDragLeaveForOverlay:function(a){var b=this;this.handleDragLeave(a,function(){b.hideDroppableOverlay()})},handleDragLeaveForDroppable:function(a){this.handleDragLeave(a)},handleDragOverForOverlay:function(a){a.stopPropagation();a.preventDefault();a.originalEvent.dataTransfer.dropEffect="copy"},hideDroppableOverlay:function(){this.$el.find(".droppable-overlay").hide();this.$el.removeClass("drag-ongoing")},
handleDrop:function(a){a.preventDefault();c(a.target).trigger("dragleave");this.hideDroppableOverlay();this.preSaveAttachments(a.originalEvent.dataTransfer.files)},stopPropagation:function(a){a.stopPropagation()},createHTML:function(){var a=this.createMainCommentingFieldElement();this.$el.append(a);a.find(".control-row").hide();a.find(".close").hide();this.options.enableNavigation&&(this.$el.append(this.createNavigationElement()),this.showActiveSort());a=this.createSpinner();this.$el.append(a);a=
c("<div/>",{"class":"data-container","data-container":"comments"});this.$el.append(a);var b=c("<div/>",{"class":"no-comments no-data",text:this.options.textFormatter(this.options.noCommentsText)}),d=c("<i/>",{"class":"fa fa-comments fa-2x"});this.options.noCommentsIconURL.length&&(d.css("background-image",'url("'+this.options.noCommentsIconURL+'")'),d.addClass("image"));b.prepend(c("<br/>")).prepend(d);a.append(b);if(this.options.enableAttachments){a=c("<div/>",{"class":"data-container","data-container":"attachments"});
this.$el.append(a);b=c("<div/>",{"class":"no-attachments no-data",text:this.options.textFormatter(this.options.noAttachmentsText)});d=c("<i/>",{"class":"fa fa-paperclip fa-2x"});this.options.attachmentIconURL.length&&(d.css("background-image",'url("'+this.options.attachmentIconURL+'")'),d.addClass("image"));b.prepend(c("<br/>")).prepend(d);a.append(b);a=c("<div/>",{"class":"droppable-overlay"});b=c("<div/>",{"class":"droppable-container"});d=c("<div/>",{"class":"droppable"});var e=c("<i/>",{"class":"fa fa-paperclip fa-4x"});
this.options.uploadIconURL.length&&(e.css("background-image",'url("'+this.options.uploadIconURL+'")'),e.addClass("image"));var f=c("<div/>",{text:this.options.textFormatter(this.options.attachmentDropText)});d.append(e);d.append(f);a.html(b.html(d)).hide();this.$el.append(a)}},createProfilePictureElement:function(a,b){a=a?c("<div/>").css({"background-image":"url("+a+")"}):c("<i/>",{"class":"fa fa-user"});a.addClass("profile-picture");a.attr("data-user-id",b);this.options.roundProfilePictures&&a.addClass("round");
return a},createMainCommentingFieldElement:function(){return this.createCommentingFieldElement(void 0,void 0,!0)},createCommentingFieldElement:function(a,b,d){var e=this,f=c("<div/>",{"class":"commenting-field"});d&&f.addClass("main");if(b){var k=this.commentsById[b].profilePictureURL;var g=this.commentsById[b].creator;var h=this.commentsById[b].attachments}else k=this.options.profilePictureURL,g=this.options.creator,h=[];g=this.createProfilePictureElement(k,g);var m=c("<div/>",{"class":"textarea-wrapper"}),
p=c("<div/>",{"class":"control-row"});k=c("<div/>",{"class":"textarea","data-placeholder":this.options.textFormatter(this.options.textareaPlaceholderText),contenteditable:!0});this.adjustTextareaHeight(k,!1);var q=this.createCloseButton();q.addClass("inline-button");var n=b?"update":"send",l=b?this.options.textFormatter(this.options.saveText):this.options.textFormatter(this.options.sendText);n=c("<span/>",{"class":n+" save highlight-background",text:l});n.data("original-content",l);p.append(n);b&&
this.isAllowedToDelete(b)&&(b=this.options.textFormatter(this.options.deleteText),l=c("<span/>",{"class":"delete enabled",text:b}).css("background-color",this.options.deleteButtonColor),l.data("original-content",b),p.append(l));if(this.options.enableAttachments){b=c("<span/>",{"class":"enabled upload"});l=c("<i/>",{"class":"fa fa-paperclip"});n=c("<input/>",{type:"file",multiple:"multiple","data-role":"none"});this.options.uploadIconURL.length&&(l.css("background-image",'url("'+this.options.uploadIconURL+
'")'),l.addClass("image"));b.append(l).append(n);l=b.clone();l.data("original-content",l.children());p.append(l);d&&m.append(b.clone().addClass("inline-button"));var r=c("<div/>",{"class":"attachments"});c(h).each(function(a,b){a=e.createAttachmentTagElement(b,!0);r.append(a)});p.append(r)}m.append(q).append(k).append(p);f.append(g).append(m);a&&(k.attr("data-parent",a),a=this.commentsById[a],a.parent&&(k.html("&nbsp;"),a=this.createTagElement("@"+a.fullname,"reply-to",a.creator,{"data-user-id":a.creator}),
k.prepend(a)));this.options.enablePinging&&(k.textcomplete([{match:/(^|\s)@([^@]*)$/i,index:2,search:function(a,b){a=e.normalizeSpaces(a);e.options.searchUsers(a,b,function(){b([])})},template:function(a){var b=c("<div/>"),d=e.createProfilePictureElement(a.profile_picture_url),f=c("<div/>",{"class":"details"}),g=c("<div/>",{"class":"name"}).html(a.fullname),k=c("<div/>",{"class":"email"}).html(a.email);a.email?f.append(g).append(k):(f.addClass("no-email"),f.append(g));b.append(d).append(f);return b.html()},
replace:function(a){return" "+e.createTagElement("@"+a.fullname,"ping",a.id,{"data-user-id":a.id})[0].outerHTML+" "}}],{appendTo:".jquery-comments",dropdownClassName:"dropdown autocomplete",maxCount:5,rightEdgeOffset:0,debounce:250}),c.fn.textcomplete.Dropdown.prototype.render=function(a){var b=this._buildContents(a),d=c.map(a,function(a){return a.value});a.length?(a=a[0].strategy,a.id?this.$el.attr("data-strategy",a.id):this.$el.removeAttr("data-strategy"),this._renderHeader(d),this._renderFooter(d),
b&&(this._renderContents(b),this._fitToBottom(),this._fitToRight(),this._activateIndexedItem()),this._setScroll()):this.noResultsMessage?this._renderNoResultsMessage(d):this.shown&&this.deactivate();b=parseInt(this.$el.css("top"))+e.options.scrollContainer.scrollTop();this.$el.css("top",b);b=this.$el.css("left");this.$el.css("left",0);d=e.$el.width()-this.$el.outerWidth();b=Math.min(d,parseInt(b));this.$el.css("left",b)},c.fn.textcomplete.ContentEditable.prototype._skipSearch=function(a){switch(a.keyCode){case 9:case 13:case 16:case 17:case 33:case 34:case 40:case 38:case 27:return!0}if(a.ctrlKey)switch(a.keyCode){case 78:case 80:return!0}});
return f},createNavigationElement:function(){var a=c("<ul/>",{"class":"navigation"}),b=c("<div/>",{"class":"navigation-wrapper"});a.append(b);var d=c("<li/>",{text:this.options.textFormatter(this.options.newestText),"data-sort-key":"newest","data-container-name":"comments"}),e=c("<li/>",{text:this.options.textFormatter(this.options.oldestText),"data-sort-key":"oldest","data-container-name":"comments"}),f=c("<li/>",{text:this.options.textFormatter(this.options.popularText),"data-sort-key":"popularity",
"data-container-name":"comments"}),k=c("<li/>",{text:this.options.textFormatter(this.options.attachmentsText),"data-sort-key":"attachments","data-container-name":"attachments"}),g=c("<i/>",{"class":"fa fa-paperclip"});this.options.attachmentIconURL.length&&(g.css("background-image",'url("'+this.options.attachmentIconURL+'")'),g.addClass("image"));k.prepend(g);g=c("<div/>",{"class":"navigation-wrapper responsive"});var h=c("<ul/>",{"class":"dropdown"}),m=c("<li/>",{"class":"title"}),p=c("<header/>");
m.append(p);g.append(m);g.append(h);a.append(g);b.append(d).append(e);h.append(d.clone()).append(e.clone());if(this.options.enableReplying||this.options.enableUpvoting)b.append(f),h.append(f.clone());this.options.enableAttachments&&(b.append(k),g.append(k.clone()));this.options.forceResponsive&&this.forceResponsive();return a},createSpinner:function(a){var b=c("<div/>",{"class":"spinner"});a&&b.addClass("inline");a=c("<i/>",{"class":"fa fa-spinner fa-spin"});this.options.spinnerIconURL.length&&(a.css("background-image",
'url("'+this.options.spinnerIconURL+'")'),a.addClass("image"));b.html(a);return b},createCloseButton:function(a){a=c("<span/>",{"class":a||"close"});var b=c("<i/>",{"class":"fa fa-times"});this.options.closeIconURL.length&&(b.css("background-image",'url("'+this.options.closeIconURL+'")'),b.addClass("image"));a.html(b);return a},createCommentElement:function(a){var b=c("<li/>",{"data-id":a.id,"class":"comment"}).data("model",a);a.createdByCurrentUser&&b.addClass("by-current-user");a.createdByAdmin&&
b.addClass("by-admin");var d=c("<ul/>",{"class":"child-comments"}),e=this.createCommentWrapperElement(a);b.append(e);null==a.parent&&b.append(d);return b},createCommentWrapperElement:function(a){var b=this,d=c("<div/>",{"class":"comment-wrapper"}),e=this.createProfilePictureElement(a.profilePictureURL,a.creator),f=c("<time/>",{text:this.options.timeFormatter(a.created),"data-original":a.created}),k=c("<div/>",{"class":"comment-header"}),g=c("<span/>",{"class":"name","data-user-id":a.creator,text:a.createdByCurrentUser?
this.options.textFormatter(this.options.youText):a.fullname});k.append(g);a.createdByAdmin&&g.addClass("highlight-font-bold");if(a.parent&&(g=this.commentsById[a.parent],g.parent)){g=c("<span/>",{"class":"reply-to",text:g.fullname,"data-user-id":g.creator});var h=c("<i/>",{"class":"fa fa-share"});this.options.replyIconURL.length&&(h.css("background-image",'url("'+this.options.replyIconURL+'")'),h.addClass("image"));g.prepend(h);k.append(g)}a.isNew&&(g=c("<span/>",{"class":"new highlight-background",
text:this.options.textFormatter(this.options.newText)}),k.append(g));g=c("<div/>",{"class":"wrapper"});h=c("<div/>",{"class":"content"});h.html(this.getFormattedCommentContent(a));if(a.modified&&a.modified!=a.created){var m=this.options.timeFormatter(a.modified);m=c("<time/>",{"class":"edited",text:this.options.textFormatter(this.options.editedText)+" "+m,"data-original":a.modified});h.append(m)}m=c("<div/>",{"class":"attachments"});var p=c("<div/>",{"class":"previews"}),q=c("<div/>",{"class":"tags"});
m.append(p).append(q);this.options.enableAttachments&&a.hasAttachments()&&c(a.attachments).each(function(a,d){var e=void 0;d.mime_type&&(a=d.mime_type.split("/"),2==a.length&&(e=a[0]));if("image"==e||"video"==e){a=c("<div/>");var f=c("<a/>",{"class":"preview",href:d.file,target:"_blank"});a.html(f);"image"==e?(e=c("<img/>",{src:d.file}),f.html(e)):(e=c("<video/>",{src:d.file,type:d.mime_type,controls:"controls"}),f.html(e));p.append(a)}d=b.createAttachmentTagElement(d,!1);q.append(d)});var n=c("<span/>",
{"class":"actions"}),l=c("<span/>",{"class":"separator",text:"\u00b7"}),r=c("<button/>",{"class":"action reply",type:"button",text:this.options.textFormatter(this.options.replyText)}),t=c("<i/>",{"class":"fa fa-thumbs-up"});this.options.upvoteIconURL.length&&(t.css("background-image",'url("'+this.options.upvoteIconURL+'")'),t.addClass("image"));t=this.createUpvoteElement(a);this.options.enableReplying&&n.append(r);this.options.enableUpvoting&&n.append(t);if(a.createdByCurrentUser||this.options.currentUserIsAdmin)a=
c("<button/>",{"class":"action edit",text:this.options.textFormatter(this.options.editText)}),n.append(a);n.children().each(function(a,b){c(b).is(":last-child")||c(b).after(l.clone())});g.append(h);g.append(m);g.append(n);d.append(e).append(f).append(k).append(g);return d},createUpvoteElement:function(a){var b=c("<i/>",{"class":"fa fa-thumbs-up"});this.options.upvoteIconURL.length&&(b.css("background-image",'url("'+this.options.upvoteIconURL+'")'),b.addClass("image"));return c("<button/>",{"class":"action upvote"+
(a.userHasUpvoted?" highlight-font":"")}).append(c("<span/>",{text:a.upvoteCount,"class":"upvote-count"})).append(b)},createTagElement:function(a,b,d,e){var f=c("<input/>",{"class":"tag",type:"button","data-role":"none"});b&&f.addClass(b);f.val(a);f.attr("data-value",d);e&&f.attr(e);return f},createAttachmentTagElement:function(a,b){var d=c("<a/>",{"class":"tag attachment",target:"_blank"});b||d.attr("href",a.file);d.data({id:a.id,mime_type:a.mime_type,file:a.file});a.file instanceof File?a=a.file.name:
(a=a.file.split("/"),a=a[a.length-1],a=a.split("?")[0],a=decodeURIComponent(a));var e=c("<i/>",{"class":"fa fa-paperclip"});this.options.attachmentIconURL.length&&(e.css("background-image",'url("'+this.options.attachmentIconURL+'")'),e.addClass("image"));d.append(e,a);b&&(d.addClass("deletable"),b=this.createCloseButton("delete"),d.append(b));return d},reRenderComment:function(a){var b=this.commentsById[a],d=this;this.$el.find('li.comment[data-id="'+b.id+'"]').each(function(a,f){a=d.createCommentWrapperElement(b);
c(f).find(".comment-wrapper").first().replaceWith(a)})},reRenderCommentActionBar:function(a){var b=this.commentsById[a],d=this;this.$el.find('li.comment[data-id="'+b.id+'"]').each(function(a,f){a=d.createCommentWrapperElement(b);c(f).find(".actions").first().replaceWith(a.find(".actions"))})},reRenderUpvotes:function(a){var b=this.commentsById[a],d=this;this.$el.find('li.comment[data-id="'+b.id+'"]').each(function(a,f){a=d.createUpvoteElement(b);c(f).find(".upvote").first().replaceWith(a)})},createCssDeclarations:function(){c("head style.jquery-comments-css").remove();
this.createCss(".jquery-comments ul.navigation li.active:after {background: "+this.options.highlightColor+" !important;",NaN);this.createCss(".jquery-comments ul.navigation ul.dropdown li.active {background: "+this.options.highlightColor+" !important;",NaN);this.createCss(".jquery-comments .highlight-background {background: "+this.options.highlightColor+" !important;",NaN);this.createCss(".jquery-comments .highlight-font {color: "+this.options.highlightColor+" !important;}");this.createCss(".jquery-comments .highlight-font-bold {color: "+
this.options.highlightColor+" !important;font-weight: bold;}")},createCss:function(a){a=c("<style/>",{type:"text/css","class":"jquery-comments-css",text:a});c("head").append(a)},getComments:function(){var a=this;return Object.keys(this.commentsById).map(function(b){return a.commentsById[b]})},getChildComments:function(a){return this.getComments().filter(function(b){return b.parent==a})},getAttachments:function(){return this.getComments().filter(function(a){return a.hasAttachments()})},getOutermostParent:function(a){do{var b=
this.commentsById[a];a=b.parent}while(null!=b.parent);return b},createCommentJSON:function(a){var b=a.find(".textarea"),c=(new Date).toISOString();return{id:"c"+(this.getComments().length+1),parent:b.attr("data-parent")||null,created:c,modified:c,content:this.getTextareaContent(b),pings:this.getPings(b),fullname:this.options.textFormatter(this.options.youText),profilePictureURL:this.options.profilePictureURL,createdByCurrentUser:!0,upvoteCount:0,userHasUpvoted:!1,attachments:this.getAttachmentsFromCommentingField(a)}},
isAllowedToDelete:function(a){if(this.options.enableDeleting){var b=!0;this.options.enableDeletingCommentWithReplies||c(this.getComments()).each(function(c,e){e.parent==a&&(b=!1)});return b}return!1},setToggleAllButtonText:function(a,b){var c=this,e=a.find("span.text"),f=a.find(".caret"),h=function(){var b=c.options.textFormatter(c.options.viewAllRepliesText),d=a.siblings(".comment").not(".hidden").length;b=b.replace("__replyCount__",d);e.text(b)},g=this.options.textFormatter(this.options.hideRepliesText);
b?(e.text()==g?h():e.text(g),f.toggleClass("up")):e.text()!=g&&h()},setButtonState:function(a,b,c){a.toggleClass("enabled",b);c?a.html(this.createSpinner(!0)):a.html(a.data("original-content"))},adjustTextareaHeight:function(a,b){a=c(a);b=1==b?this.options.textareaRowsOnFocus:this.options.textareaRows;do{a.css("height",2.2+1.45*(b-1)+"em");b++;var d=a[0].scrollHeight>a.outerHeight(),e=0==this.options.textareaMaxRows?!1:b>this.options.textareaMaxRows}while(d&&!e)},clearTextarea:function(a){a.empty().trigger("input")},
getTextareaContent:function(a,b){a=a.clone();a.find(".reply-to.tag").remove();a.find(".tag.hashtag").replaceWith(function(){return b?c(this).val():"#"+c(this).attr("data-value")});a.find(".tag.ping").replaceWith(function(){return b?c(this).val():"@"+c(this).attr("data-value")});a=c("<pre/>").html(a.html());a.find("div, p, br").replaceWith(function(){return"\n"+this.innerHTML});a=a.text().replace(/^\s+/g,"");return a=this.normalizeSpaces(a)},getFormattedCommentContent:function(a,b){var c=this.escape(a.content);
c=this.highlightTags(a,c);b&&(c=c.replace(/(?:\n)/g,"<br>"));return c},getPings:function(a){var b={};a.find(".ping").each(function(a,e){a=parseInt(c(e).attr("data-value"));e=c(e).val();b[a]=e.slice(1)});return b},getAttachmentsFromCommentingField:function(a){return a.find(".attachments .attachment").map(function(){return c(this).data()}).toArray()},moveCursorToEnd:function(a){a=c(a)[0];c(a).trigger("input");c(a).scrollTop(a.scrollHeight);if("undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var b=
document.createRange();b.selectNodeContents(a);b.collapse(!1);var d=window.getSelection();d.removeAllRanges();d.addRange(b)}else"undefined"!=typeof document.body.createTextRange&&(b=document.body.createTextRange(),b.moveToElementText(a),b.collapse(!1),b.select());a.focus()},ensureElementStaysVisible:function(a){var b=a.position().top;a=a.position().top+a.outerHeight()-this.options.scrollContainer.outerHeight();this.options.scrollContainer.scrollTop()>b?this.options.scrollContainer.scrollTop(b):this.options.scrollContainer.scrollTop()<
a&&this.options.scrollContainer.scrollTop(a)},escape:function(a){return c("<pre/>").text(this.normalizeSpaces(a)).html()},normalizeSpaces:function(a){return a.replace(/\u00a0/g," ")},after:function(a,b){var c=this;return function(){a--;if(0==a)return b.apply(c,arguments)}},highlightTags:function(a,b){this.options.enableHashtags&&(b=this.highlightHashtags(a,b));this.options.enablePinging&&(b=this.highlightPings(a,b));return b},highlightHashtags:function(a,b){var c=this;-1!=b.indexOf("#")&&(b=b.replace(/(^|\s)#([a-z\u00C0-\u00FF\d-_]+)/gim,
function(a,b,d){a=d;a=c.createTagElement("#"+a,"hashtag",a);return b+a[0].outerHTML}));return b},highlightPings:function(a,b){var d=this;-1!=b.indexOf("@")&&c(Object.keys(a.pings)).each(function(c,f){c="@"+a.pings[f];b=b.replace(new RegExp(c,"g"),d.createTagElement(c,"ping",f,{"data-user-id":f})[0].outerHTML)});return b},linkify:function(a){var b=/(\b(https?|ftp|file):\/\/[-A-Z\u00c4\u00d6\u00c50-9+&@#\/%?=~_|!:,.;{}]*[-A-Z\u00c4\u00d6\u00c50-9+&@#\/%=~_|{}])/gim;var c=a.replace(b,'<a href="$1" target="_blank">$1</a>');
var e=/(^|[^\/f])(www\.[-A-Z\u00c4\u00d6\u00c50-9+&@#\/%?=~_|!:,.;{}]*[-A-Z\u00c4\u00d6\u00c50-9+&@#\/%=~_|{}])/gim;c=c.replace(e,'$1<a href="https://$2" target="_blank">$2</a>');var f=/(([A-Z\u00c4\u00d6\u00c50-9\-_\.])+@[A-Z\u00c4\u00d6\u00c5_]+?(\.[A-Z\u00c4\u00d6\u00c5]{2,6})+)/gim;c=c.replace(f,'<a href="mailto:$1" target="_blank">$1</a>');if(0<(a.match(/<a href/g)||[]).length){a=a.split(/(<\/a>)/g);for(c=0;c<a.length;c++)null==a[c].match(/<a href/g)&&(a[c]=a[c].replace(b,'<a href="$1" target="_blank">$1</a>').replace(e,
'$1<a href="https://$2" target="_blank">$2</a>').replace(f,'<a href="mailto:$1" target="_blank">$1</a>'));return a.join("")}return c},waitUntil:function(a,b){var c=this;a()?b():setTimeout(function(){c.waitUntil(a,b)},100)},areArraysEqual:function(a,b){if(a.length!=b.length)return!1;a.sort();b.sort();for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0},applyInternalMappings:function(a){var b={},c=this.options.fieldMappings,e;for(e in c)c.hasOwnProperty(e)&&(b[c[e]]=e);return this.applyMappings(b,
a)},applyExternalMappings:function(a){return this.applyMappings(this.options.fieldMappings,a)},applyMappings:function(a,b){var c={},e;for(e in b)e in a&&(c[a[e]]=b[e]);return c}};c.fn.comments=function(a){return this.each(function(){var b=Object.create(h);c.data(this,"comments",b);b.init(a||{},this)})}});
